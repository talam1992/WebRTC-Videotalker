(this["webpackJsonpvideo-talker-frontend"]=this["webpackJsonpvideo-talker-frontend"]||[]).push([[0],{102:function(e,t,n){},103:function(e,t,n){},104:function(e,t,n){},105:function(e,t,n){},106:function(e,t,n){},107:function(e,t,n){},108:function(e,t,n){},109:function(e,t,n){},113:function(e,t,n){},114:function(e,t,n){"use strict";n.r(t);var c,a,r,o,i=n(0),s=n.n(i),l=n(26),d=n.n(l),u=n(14),b=n(17),j=n(2),f="DASHBOARD.SET_USERNAME",h="DASHBOARD.SET_ACTIVE_USERS",m={username:"",activeUsers:[]},p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case f:return Object(j.a)(Object(j.a)({},e),{},{username:t.username});case h:return Object(j.a)(Object(j.a)({},e),{},{activeUsers:t.activeUsers});default:return e}},g="CALL_AVAILABLE",O="CALL_REQUESTED",_="CALL_IN_PROGRESS",v="CALL.SET_LOCAL_STREAM",x="CALL.SET_CALL_STATE",S="CALL.SET_CALLING_DIALOG_VISIBLE",C="CALL.SET_CALLER_USERNAME",E="CALL.SET_CALL_REJECTED",k="CALL.SET_REMOTE_STREAM",A="CALL.SET_LOCAL_MICROPHONE_ENABLED",y="CALL.SET_LOCAL_CAMERA_ENABLED",L="CALL.SET_SCREEN_SHARING_ACTIVE",w="CALL.RESET_ALL_CALL_DATA",T=function(e){return{type:x,callState:e}},N=function(e){return{type:S,visible:e}},R=function(e){return{type:E,callRejected:{rejected:e.rejected,reason:e.reason}}},I=function(e){return{type:L,active:e}},U={localStream:null,callState:"CALL_UNAVAILABLE",callingDialogVisible:!1,callerUsername:"",callRejected:{rejected:!1,reason:""},remoteStream:null,localCameraEnabled:!0,localMicrophoneEnabled:!0,screenSharingActive:!1},D=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case v:return Object(j.a)(Object(j.a)({},e),{},{localStream:t.localStream});case x:return Object(j.a)(Object(j.a)({},e),{},{callState:t.callState});case S:return Object(j.a)(Object(j.a)({},e),{},{callingDialogVisible:t.visible});case C:return Object(j.a)(Object(j.a)({},e),{},{callerUsername:t.callerUsername});case E:return Object(j.a)(Object(j.a)({},e),{},{callRejected:t.callRejected});case k:return Object(j.a)(Object(j.a)({},e),{},{remoteStream:t.remoteStream});case y:return Object(j.a)(Object(j.a)({},e),{},{localCameraEnabled:t.enabled});case A:return Object(j.a)(Object(j.a)({},e),{},{localMicrophoneEnabled:t.enabled});case L:return Object(j.a)(Object(j.a)({},e),{},{screenSharingActive:t.active});case w:return Object(j.a)(Object(j.a)({},e),{},{remoteStream:null,screenSharingActive:!1,callerUsername:"",localMicrophoneEnabled:!0,localCameraEnabled:!0,callingDialogVisible:!1});default:return e}},V=Object(b.combineReducers)({dashboard:p,call:D}),M=n(56),B=Object(b.createStore)(V,Object(M.composeWithDevTools)()),H=(n(69),n(35)),P=n(4),G=n(57),J=n.n(G),F=n(9),W=n.n(F),Q=n(20),Y=n(27),q=n(58),z="CALL_ACCEPTED",K="CALL_REJECTED",X="CALL_NOT_AVAILABLE",Z={video:!0,audio:!0},$={iceServers:[{urls:"stun:stun.l.google.com:13902"}]},ee=function(){navigator.mediaDevices.getUserMedia(Z).then((function(e){B.dispatch({type:v,localStream:e}),B.dispatch(T(g)),te()})).catch((function(e){console.log("error occured when trying to get an access to get local stream"),console.log(e)}))},te=function(){a=new RTCPeerConnection($);var e,t=B.getState().call.localStream,n=Object(q.a)(t.getTracks());try{for(n.s();!(e=n.n()).done;){var r=e.value;a.addTrack(r,t)}}catch(o){n.e(o)}finally{n.f()}a.ontrack=function(e){var t=Object(Y.a)(e.streams,1)[0];B.dispatch({type:k,remoteStream:t})},a.onicecandidate=function(e){console.log("geeting candidates from stun server"),e.candidate&&ge({candidate:e.candidate,connectedUserSocketId:c})},a.onconnectionstatechange=function(e){"connected"===a.connectionState&&console.log("succesfully connected with other peer")}},ne=function(e){var t;ie()?(c=e.callerSocketId,B.dispatch((t=e.callerUsername,{type:C,callerUsername:t})),B.dispatch(T(O))):he({callerSocketId:e.callerSocketId,answer:X})},ce=function(){var e=Object(Q.a)(W.a.mark((function e(){var t;return W.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.createOffer();case 2:return t=e.sent,e.next=5,a.setLocalDescription(t);case 5:me({calleeSocketId:c,offer:t});case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ae=function(){var e=Object(Q.a)(W.a.mark((function e(t){var n;return W.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.setRemoteDescription(t.offer);case 2:return e.next=4,a.createAnswer();case 4:return n=e.sent,e.next=7,a.setLocalDescription(n);case 7:pe({callerSocketId:c,answer:n});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),re=function(){var e=Object(Q.a)(W.a.mark((function e(t){return W.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.setRemoteDescription(t.answer);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),oe=function(){var e=Object(Q.a)(W.a.mark((function e(t){return W.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("adding ice candidates"),e.next=4,a.addIceCandidate(t.candidate);case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.error("error occured when trying to add received ice candidate",e.t0);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),ie=function(){return null!==B.getState().call.localStream&&B.getState().call.callState===g},se=function(){var e=Object(Q.a)(W.a.mark((function e(){var t,n,c;return W.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(B.getState().call.screenSharingActive){e.next=16;break}return e.prev=1,e.next=4,navigator.mediaDevices.getDisplayMedia({video:!0});case 4:r=e.sent,B.dispatch(I(!0)),t=a.getSenders(),t.find((function(e){return e.track.kind==r.getVideoTracks()[0].kind})).replaceTrack(r.getVideoTracks()[0]),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),console.error("error occured when trying to get screen sharing stream",e.t0);case 14:e.next=22;break;case 16:n=B.getState().call.localStream,c=a.getSenders(),c.find((function(e){return e.track.kind==n.getVideoTracks()[0].kind})).replaceTrack(n.getVideoTracks()[0]),B.dispatch(I(!1)),r.getTracks().forEach((function(e){return e.stop()}));case 22:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(){return e.apply(this,arguments)}}(),le=function(){Oe({connectedUserSocketId:c}),de()},de=function(){B.getState().call.screenSharingActive&&r.getTracks().forEach((function(e){e.stop()})),B.dispatch({type:w}),a.close(),a=null,te(),ue();var e=B.getState().call.localStream;e.getVideoTracks()[0].enabled=!0,e.getAudioTracks()[0].enabled=!0},ue=function(){c=null,B.dispatch(T(g))},be="ACTIVE_USERS",je=function(){(o=J()("http://localhost:5000")).on("connection",(function(){console.log("succesfully connected with wss server"),console.log(o.id)})),o.on("broadcast",(function(e){_e(e)})),o.on("pre-offer",(function(e){ne(e)})),o.on("pre-offer-answer",(function(e){!function(e){var t;B.dispatch(N(!1)),e.answer===z?ce():(t=e.answer===X?"Callee is not able to pick up the call right now":"Call rejected by the callee",B.dispatch(R({rejected:!0,reason:t})),ue())}(e)})),o.on("webRTC-offer",(function(e){ae(e)})),o.on("webRTC-answer",(function(e){re(e)})),o.on("webRTC-candidate",(function(e){oe(e)})),o.on("user-hanged-up",(function(){de()}))},fe=function(e){o.emit("pre-offer",e)},he=function(e){o.emit("pre-offer-answer",e)},me=function(e){o.emit("webRTC-offer",e)},pe=function(e){o.emit("webRTC-answer",e)},ge=function(e){o.emit("webRTC-candidate",e)},Oe=function(e){o.emit("user-hanged-up",e)},_e=function(e){switch(e.event){case be:var t=e.activeUsers.filter((function(e){return e.socketId!==o.id}));B.dispatch(function(e){return{type:h,activeUsers:e}}(t))}},ve=n.p+"static/media/logo.d549b294.png",xe=n.p+"static/media/userAvatar.a6143582.png",Se=n(1),Ce=function(e){var t=e.activeUser,n=e.callState;return console.log(t),Object(Se.jsxs)("div",{className:"active_user_list_item",onClick:function(){var e;n===g&&(c=(e=t).socketId,B.dispatch(T(_)),B.dispatch(N(!0)),fe({callee:e,caller:{username:B.getState().dashboard.username}}))},children:[Object(Se.jsx)("div",{className:"active_user_list_image_container",children:Object(Se.jsx)("img",{className:"active_user_list_image",src:xe})}),Object(Se.jsx)("span",{className:"active_user_list_text",children:t.username})]})},Ee=(n(102),Object(u.b)((function(e){var t=e.dashboard,n=e.call;return Object(j.a)(Object(j.a)({},t),n)}))((function(e){var t=e.activeUsers,n=e.callState;return Object(Se.jsx)("div",{className:"active_user_list_container",children:t.map((function(e){return Object(Se.jsx)(Ce,{activeUser:e,callState:n},e.socketId)}))})}))),ke={videoContainer:{width:"150px",height:"150px",borderRadius:"8px",position:"absolute",top:"5%",right:"23%"},videoElement:{width:"100%",height:"100%"}},Ae=function(e){var t=e.localStream,n=Object(i.useRef)();return Object(i.useEffect)((function(){if(t){var e=n.current;e.srcObject=t,e.onloadedmetadata=function(){e.play()}}}),[t]),Object(Se.jsx)("div",{style:ke.videoContainer,className:"background_secondary_color",children:Object(Se.jsx)("video",{style:ke.videoElement,ref:n,autoPlay:!0,muted:!0})})},ye={videoContainer:{width:"100%",height:"100%"},videoElement:{width:"100%",height:"100%"}},Le=function(e){var t=e.remoteStream,n=Object(i.useRef)();return Object(i.useEffect)((function(){if(t){var e=n.current;e.srcObject=t,e.onloadedmetadata=function(){e.play()}}}),[t]),Object(Se.jsx)("div",{style:ye.videoContainer,children:Object(Se.jsx)("video",{style:ye.videoElement,ref:n,autoPlay:!0,muted:!0})})},we=(n(103),function(e){var t=e.reason,n=e.hideCallRejectedDialog;return Object(i.useEffect)((function(){setTimeout((function(){n({rejected:!1,reason:""})}),[4e3])}),[]),Object(Se.jsx)("div",{className:"call_rejected_dialog background_secondary_color",children:Object(Se.jsx)("span",{children:t})})}),Te=(n(104),function(e){var t=e.callerUsername;return Object(Se.jsxs)("div",{className:"direct_call_dialog background_secondary_color",children:[Object(Se.jsx)("span",{className:"direct_call_dialog_caller_name",children:t}),Object(Se.jsxs)("div",{className:"direct_call_dialog_button_container",children:[Object(Se.jsx)("button",{className:"direct_call_dialog_accept_button",onClick:function(){he({callerSocketId:c,answer:z}),B.dispatch(T(_))},children:"Accept"}),Object(Se.jsx)("button",{className:"direct_call_dialog_reject_button",onClick:function(){he({callerSocketId:c,answer:K}),ue()},children:"Reject"})]})]})}),Ne=(n(105),n(15)),Re={buttonContainer:{marginTop:"10px",width:"40px",height:"40px",borderRadius:"40px",border:"2px solid #e6e5e8",display:"flex",alignItems:"center",justifyContent:"center"}},Ie=function(){return Object(Se.jsxs)("div",{className:"direct_calling_dialog background_secondary_color",children:[Object(Se.jsx)("span",{children:"Calling"}),Object(Se.jsx)("div",{style:Re.buttonContainer,onClick:function(){le()},children:Object(Se.jsx)(Ne.a,{style:{width:"20px",height:"20px",fill:"#e6e5e8"}})})]})},Ue={button:{width:"50px",height:"50px",borderRadius:"40px",border:"2px solid #e6e5e8",textDecoration:"none",backgroundColor:"#282C34",display:"flex",alignItems:"center",justifyContent:"center",marginLeft:"10px",boxShadow:"none",borderImage:"none",borderStyle:"none",borderWidth:"0px",outline:"none"}},De=function(e){var t=e.onClickHandler;return Object(Se.jsx)("button",{style:Ue.button,onClick:t,children:e.children})},Ve={buttonContainer:{display:"flex",position:"absolute",bottom:"22%",left:"35%"},icon:{width:"25px",height:"25px",fill:"#e6e5e8"}},Me=function(e){var t=e.localStream,n=e.localCameraEnabled,c=e.localMicrophoneEnabled,a=e.setCameraEnabled,r=e.setMicrophoneEnabled,o=e.screenSharingActive;return Object(Se.jsxs)("div",{style:Ve.buttonContainer,children:[Object(Se.jsx)(De,{onClickHandler:function(){var e=c;t.getAudioTracks()[0].enabled=!e,r(!e)},children:c?Object(Se.jsx)(Ne.c,{style:Ve.icon}):Object(Se.jsx)(Ne.d,{style:Ve.icon})}),Object(Se.jsx)(De,{onClickHandler:function(){le()},children:Object(Se.jsx)(Ne.a,{style:Ve.icon})}),Object(Se.jsx)(De,{onClickHandler:function(){var e=n;t.getVideoTracks()[0].enabled=!e,a(!e)},children:n?Object(Se.jsx)(Ne.f,{style:Ve.icon}):Object(Se.jsx)(Ne.g,{style:Ve.icon})}),Object(Se.jsx)(De,{onClickHandler:function(){se()},children:o?Object(Se.jsx)(Ne.b,{style:Ve.icon}):Object(Se.jsx)(Ne.e,{style:Ve.icon})})]})};var Be=Object(u.b)((function(e){var t=e.call;return Object(j.a)({},t)}),(function(e){return{hideCallRejectedDialog:function(t){return e(R(t))},setCameraEnabled:function(t){return e(function(e){return{type:y,enabled:e}}(t))},setMicrophoneEnabled:function(t){return e(function(e){return{type:A,enabled:e}}(t))}}}))((function(e){var t=e.localStream,n=e.remoteStream,c=e.callState,a=e.callerUsername,r=e.callingDialogVisible,o=e.callRejected,i=e.hideCallRejectedDialog;return Object(Se.jsxs)(Se.Fragment,{children:[Object(Se.jsx)(Ae,{localStream:t}),n&&c===_&&Object(Se.jsx)(Le,{remoteStream:n}),o.rejected&&Object(Se.jsx)(we,{reason:o.reason,hideCallRejectedDialog:i}),c===O&&Object(Se.jsx)(Te,{callerUsername:a}),r&&Object(Se.jsx)(Ie,{}),n&&c===_&&Object(Se.jsx)(Me,Object(j.a)({},e))]})})),He=(n(106),function(e){var t=e.username;return Object(Se.jsxs)("div",{className:"dashboard_info_text_container",children:[Object(Se.jsxs)("span",{className:"dashboard_info_text_title",children:["Hello ",t," welcome in VideoTalker"]}),Object(Se.jsx)("span",{className:"dashboard_info_text_description",children:"You can start a call calling directly to a person from the list or you can create or join group call."})]})}),Pe=(n(107),function(e){var t=e.room;return Object(Se.jsx)("div",{onClick:function(){},className:"group_calls_list_item background_main_color",children:Object(Se.jsx)("span",{children:t.hostName})})}),Ge=(n(108),[{roomId:"123123",hostName:"Room 1"},{roomId:"321321",hostName:"Room 2"}]),Je=function(){return Object(Se.jsx)(Se.Fragment,{children:Ge.map((function(e){return Object(Se.jsx)(Pe,{room:e},e.roomId)}))})},Fe=Object(u.b)((function(e){var t=e.call,n=e.dashboard;return Object(j.a)(Object(j.a)({},t),n)}))((function(e){var t=e.username,n=e.callState;return Object(i.useEffect)((function(){ee(),new window.Peer(void 0,{path:"/peerjs",host:"/",port:"5000"}).on("open",(function(e){console.log("succesfully connected with peer server"),console.log(e)}))}),[]),Object(Se.jsxs)("div",{className:"dashboard_container background_main_color",children:[Object(Se.jsxs)("div",{className:"dashboard_left_section",children:[Object(Se.jsxs)("div",{className:"dashboard_content_container",children:[Object(Se.jsx)(Be,{}),n!==_&&Object(Se.jsx)(He,{username:t})]}),Object(Se.jsx)("div",{className:"dashboard_rooms_container background_secondary_color",children:Object(Se.jsx)(Je,{})})]}),Object(Se.jsxs)("div",{className:"dashboard_right_section background_secondary_color",children:[Object(Se.jsx)("div",{className:"dashboard_active_users_list",children:Object(Se.jsx)(Ee,{})}),Object(Se.jsx)("div",{className:"dashboard_logo_container",children:Object(Se.jsx)("img",{className:"dashboard_logo_image",src:ve})})]})]})})),We=function(e){var t=e.username,n=e.setUsername;return Object(Se.jsx)("div",{className:"login-page_input_container",children:Object(Se.jsx)("input",{placeholder:"Enter your name",type:"text",value:t,onChange:function(e){n(e.target.value)},className:"login-page_input background_main_color text_main_color"})})},Qe=function(e){var t=e.handleSubmitButtonPressed;return Object(Se.jsx)("div",{className:"login-page_button_container",children:Object(Se.jsx)("button",{className:"login-page_button background_main_color text_main_color",onClick:t,children:"Start using VideoTalker"})})},Ye=(n(109),Object(u.b)(null,(function(e){return{saveUsername:function(t){return e(function(e){return{type:f,username:e}}(t))}}}))((function(e){var t=e.saveUsername,n=Object(i.useState)(""),c=Object(Y.a)(n,2),a=c[0],r=c[1],s=Object(P.f)();return Object(Se.jsx)("div",{className:"login-page_container background_main_color",children:Object(Se.jsxs)("div",{className:"login-page_login_box background_secondary_color",children:[Object(Se.jsx)("div",{className:"login-page_logo_container",children:Object(Se.jsx)("img",{className:"login-page_logo_image",src:ve,alt:"VideoTalker"})}),Object(Se.jsx)("div",{className:"login-page_title_container",children:Object(Se.jsx)("h2",{children:"Get on Board"})}),Object(Se.jsx)(We,{username:a,setUsername:r}),Object(Se.jsx)(Qe,{handleSubmitButtonPressed:function(){!function(e){o.emit("register-new-user",{username:e,socketId:o.id})}(a),t(a),s.push("/dashboard")}})]})})})));var qe=function(){return Object(i.useEffect)((function(){je()}),[]),Object(Se.jsx)(H.a,{children:Object(Se.jsxs)(P.c,{children:[Object(Se.jsx)(P.a,{path:"/dashboard",children:Object(Se.jsx)(Fe,{})}),Object(Se.jsx)(P.a,{path:"/",children:Object(Se.jsx)(Ye,{})})]})})};n(113);d.a.render(Object(Se.jsx)(s.a.StrictMode,{children:Object(Se.jsx)(u.a,{store:B,children:Object(Se.jsx)(qe,{})})}),document.getElementById("root"))},69:function(e,t,n){}},[[114,1,2]]]);
//# sourceMappingURL=main.cb70863a.chunk.js.map